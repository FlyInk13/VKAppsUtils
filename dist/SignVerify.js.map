{"version":3,"sources":["../src/SignVerify.js"],"names":["require","createHmac","querystring","sha256","string","pwd","update","digest","signVerify","url","clientSecret","parsedSearch","parse","checkSumRaw","Object","keys","filter","key","test","sort","map","val","join","checkSum","replace","module","exports"],"mappings":";;eAAqBA,OAAO,CAAC,QAAD,C;IAArBC,U,YAAAA,U;;AACP,IAAMC,WAAW,GAAGF,OAAO,CAAC,aAAD,CAA3B;;AACA,IAAMG,MAAM,GAAG,SAATA,MAAS,CAACC,MAAD,EAASC,GAAT;AAAA,SAAiBJ,UAAU,CAAC,QAAD,EAAWI,GAAX,CAAV,CAA0BC,MAA1B,CAAiCF,MAAjC,EAAyCG,MAAzC,CAAgD,QAAhD,CAAjB;AAAA,CAAf;;AAEA,SAASC,UAAT,CAAoBC,GAApB,EAAyBC,YAAzB,EAAuC;AACrC,MAAMC,YAAY,GAAGT,WAAW,CAACU,KAAZ,CAAkBH,GAAlB,CAArB;AAEA,MAAMI,WAAW,GAAGC,MAAM,CACvBC,IADiB,CACZJ,YADY,EAEjBK,MAFiB,CAEV,UAACC,GAAD;AAAA,WAAS,OAAOC,IAAP,CAAYD,GAAZ,CAAT;AAAA,GAFU,EAGjBE,IAHiB,GAIjBC,GAJiB,CAIb,UAACH,GAAD,EAAS;AACZ,QAAMI,GAAG,GAAGV,YAAY,CAACM,GAAD,CAAxB;AACA,WAAOA,GAAG,GAAG,GAAN,GAAYI,GAAnB;AACD,GAPiB,EAQjBC,IARiB,CAQZ,GARY,CAApB;AAUA,MAAMC,QAAQ,GAAGpB,MAAM,CAACU,WAAD,EAAcH,YAAd,CAAN,CACdc,OADc,CACN,KADM,EACC,GADD,EAEdA,OAFc,CAEN,KAFM,EAEC,GAFD,EAGdA,OAHc,CAGN,IAHM,EAGA,EAHA,CAAjB;AAKA,SAAOD,QAAQ,KAAKZ,YAAY,CAAC,MAAD,CAAhC;AACD;;AAEDc,MAAM,CAACC,OAAP,GAAiBlB,UAAjB","sourcesContent":["const {createHmac} = require('crypto');\nconst querystring = require('querystring');\nconst sha256 = (string, pwd) => createHmac('sha256', pwd).update(string).digest('base64');\n\nfunction signVerify(url, clientSecret) {\n  const parsedSearch = querystring.parse(url);\n\n  const checkSumRaw = Object\n    .keys(parsedSearch)\n    .filter((key) => /^vk_/.test(key))\n    .sort()\n    .map((key) => {\n      const val = parsedSearch[key];\n      return key + '=' + val;\n    })\n    .join('&');\n\n  const checkSum = sha256(checkSumRaw, clientSecret)\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n\n  return checkSum === parsedSearch['sign'];\n}\n\nmodule.exports = signVerify;\n"],"file":"SignVerify.js"}